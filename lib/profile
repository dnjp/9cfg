# environment variables
font=/lib/font/bit/terminus/unicode.14.font
editor=E

# setup executables
bind -qa $home/bin/rc /bin
bind -qa $home/bin/$cputype /bin

# bind to git config
bind $home/lib/profile $home/src/config/lib/profile
bind $home/lib/git $home/src/config/lib/git
bind $home/bin/rc $home/src/config/bin/rc

# aliases
fn '..' { cd .. }
fn h { cd $home }
fn l { ls $* }
fn sdf { ftpfs -a ftp@sdf.org sdf.org }
fn gp { git/push $* }
fn gs { git/walk $* }
fn gc { git/commit $* }
fn ga { git/add $* }

# authentication
cat $home/lib/ssh/key >/mnt/factotum/ctl
ssh git@github.com
ssh git@git.sr.ht

# start services
ip/ipconfig

# mount contrib/sources
9fs 9pio
9fs 9contrib

switch($service){
case terminal
	webcookies
	webfs
	plumber
	echo -n accelerated > '#m/mousectl'
	echo -n 'res 3' > '#m/mousectl'
	prompt=('; ' '	')
	fn term%{ $* }
	
	# set keyboard map
	cat /sys/lib/kbmap/colemak > /dev/kbmap

	rio -s -i /usr/daniel/bin/rc/riostart
case cpu
	bind /mnt/term/dev/cons /dev/cons
	bind -q /mnt/term/dev/consctl /dev/consctl
	>[2] /dev/null {
		cp /dev/sysname /mnt/term/dev/label
		if(wsys=`{cat /mnt/term/env/wsys})
			wsys=/mnt/term^$wsys
	} 
	bind -a /mnt/term/dev /dev
	prompt=('cpu% ' '	')
	fn cpu%{ $* }
	if(! test -e /mnt/term/dev/wsys){
		# call from drawterm
		if(test -e /mnt/term/dev/secstore){
			auth/factotum -n
			read -m /mnt/term/dev/secstore >/mnt/factotum/ctl
			echo >/mnt/term/dev/secstore
		}
		if not
			auth/factotum
		webcookies
		webfs
		plumber
		rio
	}
case con
	prompt=('cpu% ' '	')
}
